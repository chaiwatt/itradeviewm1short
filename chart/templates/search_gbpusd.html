{% extends 'layout.html' %}

{% block content %}
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 class="m-0 " ><span id="symbol">{{symbol}}</span></h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active">Search</li>
              </ol>
            </div><!-- /.col -->
          </div><!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
      <!-- /.content-header -->
  
      <!-- Main content -->
      <div class="content">
        {% csrf_token %}
        <div class="container-fluid">
     
          <div class="row">
            <div class="col-lg-9">

                <div class="row">

                    <!-- /.col -->
                    <div class="col-md-4 col-sm-6 col-12">
                        <div class="info-box bg-primary">
                            <span class="info-box-icon"><i class="fas fa-sort-amount-up-alt"></i></span>
            
                            <div class="info-box-content">
                            <span class="info-box-text" style="font-size: 20px;">SPREAD (POINTS)</span>
                            <span class="info-box-number" id="spread" style="font-size: 26px;"></span>
            
                            
                            </div>
                            <!-- /.info-box-content -->
                        </div>
                        <!-- /.info-box -->
                        </div>
                        <!-- /.col -->
                        <div class="col-md-4 col-sm-6 col-12">
                          <div class="info-box bg-success">
                            <span class="info-box-icon"><i class="far fa-money-bill-alt"></i></span>
              
                            <div class="info-box-content">
                              <span class="info-box-text" style="font-size: 20px;">SPREAD PRICE/LOT</span>
                              <span class="info-box-number" id="spreadprice" style="font-size: 26px;"></span>
              
                           
                            </div>
                            <!-- /.info-box-content -->
                          </div>
                          <!-- /.info-box -->
                        </div>
             
                        <div class="col-md-4 col-sm-6 col-12">
                          <div class="info-box bg-info">
                            <span class="info-box-icon"><i class="fas fa-search-dollar"></i></span>
              
                            <div class="info-box-content">
                              <span class="info-box-text" style="font-size: 20px;">PIP PRICE/LOT</span>
                              <span class="info-box-number" id="pipprice" style="font-size: 26px;"></span>
              
                            </div>
                            <!-- /.info-box-content -->
                          </div>
                          <!-- /.info-box -->
                        </div>
                      </div>
               
              <div class="card">
                <div class="card-body">
                    <!-- <div id="canndle_stick_tf_m5" style="width: 98%; "></div> -->
                    <div id="canndle_stick_chart_m1" ></div>
                    <div id="canndle_stick_chart_m5" ></div>
                    <div id="canndle_stick_chart_m15"></div>
                    <div id="canndle_stick_chart_m30"></div>
                    <div id="canndle_stick_chart_h1"></div>
                    <div id="canndle_stick_chart_h4"></div>
                    <!-- <div id="macd_chart"></div> -->
                </div>
              </div>
         
  
            </div>
            <!-- /.col-md-6 -->
            <div class="col-lg-3">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">UTC Time</h3>
                      </div>
                    <div class="card-body" style="margin-bottom: -40px;margin-top: -40px;">
                        <div id="clockcontainer" style="height: 300px;"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Monitoring</h3>
                      </div>
                    <div class="card-body" >
                        <table class="table table-sm">
                            <thead>
                              <tr>
                                <th>Timeframe</th>
                                
                                <th>Slope</th>
                                <!-- <th>View</th> -->
                                <!-- <th class="text-right">Order</th> -->
                              </tr>
                            </thead>
                            <tbody id="monitoring_table">  
                                <tr><td>M1</td><td id="m1_slope"></td></tr> 
                                <tr><td>M5</td><td id="m5_slope"></td></tr> 
                                <tr><td>M15</td><td id="m15_slope"></td></tr> 
                                <tr><td>M30</td><td id="m30_slope"></td></tr> 
                                <tr><td>H1</td><td id="h1_slope"></td></tr> 
                                <tr><td>H4</td><td id="h4_slope"></td></tr> 
    
                            </tbody>
                          </table>
                    </div>
                </div>

                 <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Orders</h3>
                      </div>
                    <div class="card-body" >
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group float-right">

                                    <!-- <button type="button" id="btnGetSingleOhlc" class="btn btn-primary">Start Search</button> -->
                                    <!-- <button type="button" id="uploadImage" class="btn btn-primary">Upload Image</button> -->
                                    <button type="button" id="openbuyorder" class="btn btn-primary">Open Buy</button>
                                    <button type="button" id="opensellorder" class="btn btn-primary">Open Sell</button>
                                </div>
                               
                            </div>
                        </div>
                    </div>
                </div> 

            </div>
            <!-- /.col-md-6 -->
          </div>
          <!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>

      <div class="modal fade" id="openorder_modal">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">OPEN ORDER</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        
                        <div class="form-group">
                            <label for="stoplost">Symbol</label>
                            <input type="text" class="form-control" id="symbolname" value="" readonly>
                        </div>
                     </div>
                    <div class="col-md-12">
                        
                        <div class="form-group">
                            <label for="stoplost">Stop Lost (0.01%)</label>
                            <input type="text" class="form-control" id="stoplost" value="" >
                        </div>
                     </div>
                     <div class="col-md-12">
                        <div class="form-group">
                            <label for="takeprofit">Take Profit (2xSL)</label>
                            <input type="text" class="form-control" id="takeprofit" value="" >
                        </div>
                     </div>
                     <div class="col-md-12">
                        <div class="form-group">
                            <label for="lotsize">Lot size</label>
                            <input type="text" class="form-control" id="lotsize" value=""  >
                        </div>
                     </div>
                     <div class="col-md-12">
                        <div class="form-group">
                            <label for="price">Price</label>
                            <input type="text" class="form-control" id="price" value="" readonly >
                        </div>
                     </div>

                     <div class="col-md-12">
                        <label for="ordertype">Order Type</label>
                        <select class="form-control" name="ordertype" id="ordertype" >
                            <option value="0" >Order Buy</option>
                            <option value="1" >Order Sell</option>
                        </select>
                     </div>

                     <div class="col-md-12">
                         <div class="form-group d-flex justify-content-between align-items-center">
                            <button type="button" id="viewalltimeframe" class="btn btn-primary mt-3">View All TIMEFRAME</button>
                            <button type="button" id="ordering" data-dismiss="modal" class="btn btn-info mt-3">Open Order</button>
                         </div>
                        
                     </div>
                     
                </div>
               
            </div>
       
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>

      <div class="modal fade" id="modal-viewtimeframe">
        <div class="modal-dialog" style="max-width: 80%;">
          <div class="modal-content" >
            <div class="modal-header">
              <h4 class="modal-title" >TIMEFRAME: <span id="tfviewer"></span> </h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div id="canndle_stick_tf"></div>
                     </div>
                     <div class="col-md-12">
                         <div class="form-group float-right">
                            <button type="button" data-dismiss="modal" class="btn btn-default mt-3">close</button>
                         </div>
                     </div> 
                </div>
               
            </div>
       
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>


      <!-- /.modal -->
      <!-- /.modal -->
      <!-- /.content -->
      <script>

        // //Initialize Select2 Elements
        $('.select2').select2();

        // //Initialize Select2 Elements
        $('.select2bs4').select2({
            theme: 'bootstrap4'
        })
        var searchTimer;
        var timerInterval = 5000;
        var testRange = 250;
        var count = 0;
        var _rawData = [];
        var slopeSpec = 0.00001;

        var canndle_stick_chart_m1 = echarts.init(document.getElementById('canndle_stick_chart_m1'));  
        var canndle_stick_chart_m5 = echarts.init(document.getElementById('canndle_stick_chart_m5'));  
        var canndle_stick_chart_m15 = echarts.init(document.getElementById('canndle_stick_chart_m15'));  
        var canndle_stick_chart_m30 = echarts.init(document.getElementById('canndle_stick_chart_m30'));  
        var canndle_stick_chart_h1 = echarts.init(document.getElementById('canndle_stick_chart_h1')); 
        var canndle_stick_chart_h4 = echarts.init(document.getElementById('canndle_stick_chart_h4')); 

        // console.log(apisymbols)

        var updateapisymbols = []
        var responseData = [] ; 
        var orderbuy_entry_specs = [];
        var ordersale_entry_specs = [];

        var orderbuy_close_specs = [];
        var ordersell_close_specs = [];
        var data_m1 = []
        var data_m5 = []
        var data_m15 = []
        var data_m30 = []
        var data_h1 = []
        var data_h4 = []
        var data_tf_m1 = []
        // var data_tf_m5 = []

        var axisData_m1 = [];
        var axisData_m5 = [];
        var axisData_m15 = [];
        var axisData_m30 = [];
        var axisData_h1 = [];
        var axisData_h4 = [];

        // var SSMA20Arr = [];
        // var SSMA50Arr = [];
        // var SSMA100Arr = [];
        
        var dataMA6_m1 = [];
        var dataMA6_m5 = [];
        var dataMA6_m15 = [];
        var dataMA6_m30 = [];
        var dataMA6_h1 = [];
        var dataMA6_h4 = [];

        var dataMA10_m1 = [];
        var dataMA10_m5 = [];
        var dataMA10_m15 = [];
        var dataMA10_m30 = [];
        var dataMA10_h1 = [];
        var dataMA10_h4 = [];

        var dataMA20_m1 = [];
        var dataMA20_m5 = [];
        var dataMA20_m15 = [];
        var dataMA20_m30 = [];
        var dataMA20_h1 = [];
        var dataMA20_h4 = [];

        var dataMA35_m1 = [];
        var dataMA35_m5 = [];
        var dataMA35_m15 = [];
        var dataMA35_m30 = [];
        var dataMA35_h1 = [];
        var dataMA35_h4 = [];

        var dataMA100_m1 = [];
        var dataMA100_m5 = [];
        var dataMA100_m15 = [];
        var dataMA100_m30 = [];
        var dataMA100_h1 = [];
        var dataMA100_h4 = [];

        var dataBody_m1 = [];
        var dataBody_m5 = [];
        var dataBody_m15 = [];
        var dataBody_m30 = [];
        var dataBody_h1 = [];
        var dataBody_h4 = [];

        var tenkan_sen_h4 = [];
        var kijun_sen_h4 = [];
        var chisou_span_h4 = [];
        var senkou_span_a_h4 = [];
        var senkou_span_b_h4 = [];

        var tenkan_sen_h1 = [];
        var kijun_sen_h1 = [];
        var chisou_span_h1 = [];
        var senkou_span_a_h1 = [];
        var senkou_span_b_h1 = [];

        var tenkan_sen_m30 = [];
        var kijun_sen_m30 = [];
        var chisou_span_m30 = [];
        var senkou_span_a_m30 = [];
        var senkou_span_b_m30 = [];

        var MarkData = [];
        var MarkDataTF = [];
        var MarkDataTF_FromM1 = []
        var MarkDataTFViewser = [];
        var MacdCrossData  = [];
        var markMA100LineCord = [];
        var MarkMA100Slope  = [];
        var sma100Trend = [];
        var dataResult = null
        var sma100ArrowLevel = null
        var sma100PresentLevel = null
        var orderBuyEntryPointflag = false;
        var orderSellEntryPointflag = false;
        var testResult = [];
        var tmpDataIn = null;
        var lineLenght = 10;
        var momenttumBar = false;
        var trendPattern = false;
        var barSize = 0;
        var selectedTimeframe = '';
        var calculationinfo = null;
        var orderStatus = false;
        var orderinfo = null;
        var accumulateprice = 0;
        var presentBarInfo = null;
        var currentselecteddate = '';
        var measurepip = false;
        var measurepipvalue = [];
        var countfromorderposition = 0;
        let positionmark = 0;
        let usdbase = 1;
        let _ohlc_timeframe = []
        var allstdbarsizes = []
        var symbolCountId = 0;
        var bullishall = false;
        var bearishall = false
        var alltimeframetrend =[]
        var stdbarsize = 0;

        var dom = document.getElementById("clockcontainer");
            var clock = echarts.init(dom);
            var app = {};

            var clock_option;

            clock_option = {
              series: [
                {
                  name: 'hour',
                  type: 'gauge',
                  startAngle: 90,
                  endAngle: -270,
                  min: 0,
                  max: 24,
                  splitNumber: 24,
                  clockwise: true,
                  axisLine: {
                    lineStyle: {
                      width: 15,
                      color: [[1, 'rgba(0,0,0,0.7)']],
                      shadowColor: 'rgba(0, 0, 0, 0.5)',
                      shadowBlur: 15
                    }
                  },
                  splitLine: {
                    lineStyle: {
                      shadowColor: 'rgba(0, 0, 0, 0.3)',
                      shadowBlur: 3,
                      shadowOffsetX: 1,
                      shadowOffsetY: 2
                    }
                  },

                  pointer: {
                    icon: 'path://M2.9,0.7L2.9,0.7c1.4,0,2.6,1.2,2.6,2.6v115c0,1.4-1.2,2.6-2.6,2.6l0,0c-1.4,0-2.6-1.2-2.6-2.6V3.3C0.3,1.9,1.4,0.7,2.9,0.7z',
                    width: 12,
                    length: '55%',
                    offsetCenter: [0, '8%'],
                    itemStyle: {
                      color: '#C0911F',
                      shadowColor: 'rgba(0, 0, 0, 0.3)',
                      shadowBlur: 8,
                      shadowOffsetX: 2,
                      shadowOffsetY: 4
                    }
                  },
                  detail: {
                    show: false
                  },
                  title: {
                    offsetCenter: [0, '30%']
                  },
                  data: [
                    {
                      value: 0
                    }
                  ]
                },
                {
                  name: 'minute',
                  type: 'gauge',
                  startAngle: 90,
                  endAngle: -270,
                  min: 0,
                  max: 60,
                  clockwise: true,
                  axisLine: {
                    show: false
                  },
                  splitLine: {
                    show: false
                  },
                  axisTick: {
                    show: false
                  },
                  axisLabel: {
                    show: false
                  },
                  pointer: {
                    icon: 'path://M2.9,0.7L2.9,0.7c1.4,0,2.6,1.2,2.6,2.6v115c0,1.4-1.2,2.6-2.6,2.6l0,0c-1.4,0-2.6-1.2-2.6-2.6V3.3C0.3,1.9,1.4,0.7,2.9,0.7z',
                    width: 8,
                    length: '70%',
                    offsetCenter: [0, '8%'],
                    itemStyle: {
                      color: '#C0911F',
                      shadowColor: 'rgba(0, 0, 0, 0.3)',
                      shadowBlur: 8,
                      shadowOffsetX: 2,
                      shadowOffsetY: 4
                    }
                  },
                  anchor: {
                    show: false,
                    size: 20,
                    showAbove: false,
                    itemStyle: {
                      borderWidth: 15,
                      borderColor: '#C0911F',
                      shadowColor: 'rgba(0, 0, 0, 0.3)',
                      shadowBlur: 8,
                      shadowOffsetX: 2,
                      shadowOffsetY: 4
                    }
                  },
                  detail: {
                    show: false
                  },
                  title: {
                    offsetCenter: ['0%', '-40%']
                  },
                  data: [
                    {
                      value: 0
                    }
                  ]
                },
                
              ]
            };


            if (clock_option && typeof clock_option === 'object') {
                clock.setOption(clock_option);
            }


        function autoSearch(){
            function searching(){
                searchMarket();
            }
            searchTimer = setInterval(searching,timerInterval);
        }

        $(document).on('click','#btnGetSingleOhlc', function(){
            // if (this.classList.contains('start')) {
            //     this.classList.remove('start');
            //     this.textContent = "Start Search";
            //     clearInterval(searchTimer);
            // } else {
            //     this.classList.add('start');
            //     this.textContent = "Stop Search";
            //     autoSearch();
            // }
            
            searchMarket();
        })

        $( document ).ready(function () {   
            
            searchMarket();
            setInterval(function(){
               
                searchMarket();
             },100000)
        });
        function beep() {
        (new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+ Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ 0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7 FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb//////////////////////////// /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU="
            )).play();
        }

        function searchMarket(){
            
            // if(apisymbols.length == 0){
            //     getApiSymbols().then(data_item => {
            //         let _apisymbols = JSON.parse(data_item.apisymbols)
            //         // console.log(_apisymbols)
            //         if(_apisymbols.length > 0){
            //             apisymbols = _apisymbols
            //         }
            //     }).catch(error => {})
            // }else{
                // let symbol = parseInt(apisymbols[symbolCountId].pk);
                let timeframe = 1;
                let html_entrypoint_testspecs = ``
                let html_openbuy_testspecs = ``
                let html_opensell_testspecs = ``
                
                //  $("#headerinfo").html('(ON ORDER)').addClass("text-danger").addClass("blink");
                // console.log( $("#symbol").html())
                searchSingleOhlc($("#symbol").html(),'M1').then(data_item => {
                    usdbase = data_item.usdbase
                    calculationinfo = data_item.calculationInfo;
                    stdbarsize = data_item.stdbarsize[0]
                    // console.log(stdbarsize)
                    
               
                    isMarketClose = data_item.isMarketClose
                    let html_monitoring_symbol = ''
       
                    let pippriceperlotsize = pipPricePerLotsize(calculationinfo.symbol,calculationinfo.degit,calculationinfo.ask,calculationinfo.trade_contract_size,1,usdbase)*10;
                    let stoplossprice = parseFloat(stopLossPrice(stdbarsize.stoplostpercent,parseFloat(calculationinfo.balance)))
                    let lotsize = getLotSize(stoplossprice,stdbarsize.stoplostpip,pippriceperlotsize).toFixed(5)*stdbarsize.lotsizeoffset
                    let spreadprice = (calculationinfo.spread * pippriceperlotsize/10).toFixed(5)
                    $('#pipprice').html(pippriceperlotsize.toFixed(5));
                    $('#spreadprice').html(-spreadprice+'$');
                    $('#spread').html(calculationinfo.spread);

                    // console.log('ok')
              
    
                    createData(data_item);
                }).catch(error => {})

       
        }

        function searchSingleOhlc(symbol,timeframe){
            return new Promise((resolve, reject) => {
                data = {
                    symbol: symbol,
                    timeframe: timeframe,
                    csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
                }
                $.ajax({
                    type: 'POST',
                    url: "{% url 'searchsingleohlc' %}",
                    dataType : "json",
                    data: data,
                    success: function(data) {
                        resolve(data)
                    },
                    error: function(error) {
                        reject(error)
                    },
                })
            })
        }


        function getApiSymbols(){
            return new Promise((resolve, reject) => {
                data = {
                    csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
                }
                $.ajax({
                    type: 'POST',
                    url: "{% url 'getapisymbols' %}",
                    dataType : "json",
                    data: data,
                    success: function(data) {
                        resolve(data)
                    },
                    error: function(error) {
                        reject(error)
                    },
                })
            })
        }

        const sumArray = arr =>
        (arr || Array.of(arr))
            .sort((a, b) => a - b)
            .slice(1, (arr && (arr.length - 1)))
            .reduce((sum, n) => sum + n, 0)

        function createData(response){
            m1 = response.ohlcs_m1;
            m5 = response.ohlcs_m5;
            m15 = response.ohlcs_m15;
            m30 = response.ohlcs_m30;
            h1 = response.ohlcs_h1;
            h4 = response.ohlcs_h4;

            // console.log('h4')
            // console.log(h4)
            
            data_m1 = getData(m1);
            data_m5 = getData(m5);
            data_m15 = getData(m15);
            data_m30 = getData(m30);
            data_h1 = getData(h1);
            data_h4 = getData(h4);

            let closedPrice_m1 = getClosedPrice(m1);
            let closedPrice_m5 = getClosedPrice(m5);
            let closedPrice_m15 = getClosedPrice(m15);
            let closedPrice_m30 = getClosedPrice(m30);
            let closedPrice_h1 = getClosedPrice(h1);
            let closedPrice_h4 = getClosedPrice(h4);

            
            let _tenkan_sen_h4 =  TenkanSen(getHighPrice(h4),getLowPrice(h4),9); 
            let _kijun_sen_h4 = KijunSen(getHighPrice(h4),getLowPrice(h4),26)
            let _senkou_span_a_h4 = SenkouSpanA(_tenkan_sen_h4,_kijun_sen_h4)
            senkou_span_a_h4 = Array(50).fill(null).concat(_senkou_span_a_h4);
            let _chisou_span_h4 = ChikouSpan(closedPrice_h4);
            let _senkou_span_b_h4 = SenkouSpanB(getHighPrice(h4),getLowPrice(h4),52);
            let dataLenght_h4 = senkou_span_a_h4.length
            tenkan_sen_h4 = Array(8).fill(null).concat(_tenkan_sen_h4).concat( Array(dataLenght_h4-_tenkan_sen_h4.length-8).fill(null));
            kijun_sen_h4 = Array(25).fill(null).concat(_kijun_sen_h4).concat( Array(dataLenght_h4-_kijun_sen_h4.length-25).fill(null));
            chisou_span_h4 = _chisou_span_h4.concat(Array(dataLenght_h4-_chisou_span_h4.length).fill(null));
            senkou_span_b_h4 = Array(76).fill(null).concat(_senkou_span_b_h4);

            let _tenkan_sen_h1 =  TenkanSen(getHighPrice(h1),getLowPrice(h1),9); 
            let _kijun_sen_h1 = KijunSen(getHighPrice(h1),getLowPrice(h1),26)
            let _senkou_span_a_h1 = SenkouSpanA(_tenkan_sen_h1,_kijun_sen_h1)
            senkou_span_a_h1 = Array(50).fill(null).concat(_senkou_span_a_h1);
            let _chisou_span_h1 = ChikouSpan(closedPrice_h1);
            let _senkou_span_b_h1 = SenkouSpanB(getHighPrice(h1),getLowPrice(h1),52);
            let dataLenght_h1 = senkou_span_a_h1.length
            tenkan_sen_h1 = Array(8).fill(null).concat(_tenkan_sen_h1).concat( Array(dataLenght_h1-_tenkan_sen_h1.length-8).fill(null));
            kijun_sen_h1 = Array(25).fill(null).concat(_kijun_sen_h1).concat( Array(dataLenght_h1-_kijun_sen_h1.length-25).fill(null));
            chisou_span_h1 = _chisou_span_h1.concat(Array(dataLenght_h1-_chisou_span_h1.length).fill(null));
            senkou_span_b_h1 = Array(76).fill(null).concat(_senkou_span_b_h1);

            let _tenkan_sen_m30 =  TenkanSen(getHighPrice(m30),getLowPrice(m30),9); 
            let _kijun_sen_m30 = KijunSen(getHighPrice(m30),getLowPrice(m30),26)
            let _senkou_span_a_m30 = SenkouSpanA(_tenkan_sen_m30,_kijun_sen_m30)
            senkou_span_a_m30 = Array(50).fill(null).concat(_senkou_span_a_m30);
            let _chisou_span_m30 = ChikouSpan(closedPrice_m30);
            let _senkou_span_b_m30 = SenkouSpanB(getHighPrice(m30),getLowPrice(m30),52);
            let dataLenght_m30 = senkou_span_a_m30.length
            tenkan_sen_m30 = Array(8).fill(null).concat(_tenkan_sen_m30).concat( Array(dataLenght_m30-_tenkan_sen_m30.length-8).fill(null));
            kijun_sen_m30 = Array(25).fill(null).concat(_kijun_sen_m30).concat( Array(dataLenght_m30-_kijun_sen_m30.length-25).fill(null));
            chisou_span_m30 = _chisou_span_m30.concat(Array(dataLenght_m30-_chisou_span_m30.length).fill(null));
            senkou_span_b_m30 = Array(76).fill(null).concat(_senkou_span_b_m30);

      
            axisData_m1 = getDateLabel(m1); 
            axisData_m5 = getDateLabel(m5); 
            axisData_m15 = getDateLabel(m15); 
            axisData_m30 = getDateLabel(m30); 
            axisData_h1 = getDateLabel(h1); 
            axisData_h4 = getDateLabel(h4); 

            let SSMA6Arr_m1 = SSMA_Calc(closedPrice_m1,6);
            let SSMA6Arr_m5 = SSMA_Calc(closedPrice_m5,6);
            let SSMA6Arr_m15 = SSMA_Calc(closedPrice_m15,6);
            let SSMA6Arr_m30 = SSMA_Calc(closedPrice_m30,6);
            let SSMA6Arr_h1 = SSMA_Calc(closedPrice_h1,6);
            let SSMA6Arr_h4 = SSMA_Calc(closedPrice_h4,6);

            let SSMA10Arr_m1 = SSMA_Calc(closedPrice_m1,10);
            let SSMA10Arr_m5 = SSMA_Calc(closedPrice_m5,10);
            let SSMA10Arr_m15 = SSMA_Calc(closedPrice_m15,10);
            let SSMA10Arr_m30 = SSMA_Calc(closedPrice_m30,10);
            let SSMA10Arr_h1 = SSMA_Calc(closedPrice_h1,10);
            let SSMA10Arr_h4 = SSMA_Calc(closedPrice_h4,10);

            let SSMA20Arr_m1 = SSMA_Calc(closedPrice_m1,20);
            let SSMA20Arr_m5 = SSMA_Calc(closedPrice_m5,20);
            let SSMA20Arr_m15 = SSMA_Calc(closedPrice_m15,20);
            let SSMA20Arr_m30 = SSMA_Calc(closedPrice_m30,20);
            let SSMA20Arr_h1 = SSMA_Calc(closedPrice_h1,20);
            let SSMA20Arr_h4 = SSMA_Calc(closedPrice_h4,20);

            let SSMA35Arr_m1 = SSMA_Calc(closedPrice_m1,35);
            let SSMA35Arr_m5 = SSMA_Calc(closedPrice_m5,35);
            let SSMA35Arr_m15 = SSMA_Calc(closedPrice_m15,35);
            let SSMA35Arr_m30 = SSMA_Calc(closedPrice_m30,35);
            let SSMA35Arr_h1 = SSMA_Calc(closedPrice_h1,35);
            let SSMA35Arr_h4 = SSMA_Calc(closedPrice_h4,35);

            let SSMA100Arr_m1 = SSMA_Calc(closedPrice_m1,100);
            let SSMA100Arr_m5 = SSMA_Calc(closedPrice_m5,100);
            let SSMA100Arr_m15 = SSMA_Calc(closedPrice_m15,100);
            let SSMA100Arr_m30 = SSMA_Calc(closedPrice_m30,100);
            let SSMA100Arr_h1 = SSMA_Calc(closedPrice_h1,100);
            let SSMA100Arr_h4 = SSMA_Calc(closedPrice_h4,100);

            
            var nullSmoth_SSMA6_m1 = Array(closedPrice_m1.length - SSMA6Arr_m1.length).fill(null);
            var nullSmoth_SSMA6_m5 = Array(closedPrice_m5.length - SSMA6Arr_m5.length).fill(null);
            var nullSmoth_SSMA6_m15 = Array(closedPrice_m15.length - SSMA6Arr_m15.length).fill(null);
            var nullSmoth_SSMA6_m30 = Array(closedPrice_m30.length - SSMA6Arr_m30.length).fill(null);
            var nullSmoth_SSMA6_h1 = Array(closedPrice_h1.length - SSMA6Arr_h1.length).fill(null);
            var nullSmoth_SSMA6_h4 = Array(closedPrice_h4.length - SSMA6Arr_h4.length).fill(null);

            var nullSmoth_SSMA10_m1 = Array(closedPrice_m1.length - SSMA10Arr_m1.length).fill(null);
            var nullSmoth_SSMA10_m5 = Array(closedPrice_m5.length - SSMA10Arr_m5.length).fill(null);
            var nullSmoth_SSMA10_m15 = Array(closedPrice_m15.length - SSMA10Arr_m15.length).fill(null);
            var nullSmoth_SSMA10_m30 = Array(closedPrice_m30.length - SSMA10Arr_m30.length).fill(null);
            var nullSmoth_SSMA10_h1 = Array(closedPrice_h1.length - SSMA10Arr_h1.length).fill(null);
            var nullSmoth_SSMA10_h4 = Array(closedPrice_h4.length - SSMA10Arr_h4.length).fill(null);

            var nullSmoth_SSMA20_m1 = Array(closedPrice_m1.length - SSMA20Arr_m1.length).fill(null);
            var nullSmoth_SSMA20_m5 = Array(closedPrice_m5.length - SSMA20Arr_m5.length).fill(null);
            var nullSmoth_SSMA20_m15 = Array(closedPrice_m15.length - SSMA20Arr_m15.length).fill(null);
            var nullSmoth_SSMA20_m30 = Array(closedPrice_m30.length - SSMA20Arr_m30.length).fill(null);
            var nullSmoth_SSMA20_h1 = Array(closedPrice_h1.length - SSMA20Arr_h1.length).fill(null);
            var nullSmoth_SSMA20_h4 = Array(closedPrice_h4.length - SSMA20Arr_h4.length).fill(null);

            var nullSmoth_SSMA35_m1 = Array(closedPrice_m1.length - SSMA35Arr_m1.length).fill(null);
            var nullSmoth_SSMA35_m5 = Array(closedPrice_m5.length - SSMA35Arr_m5.length).fill(null);
            var nullSmoth_SSMA35_m15 = Array(closedPrice_m15.length - SSMA35Arr_m15.length).fill(null);
            var nullSmoth_SSMA35_m30 = Array(closedPrice_m30.length - SSMA35Arr_m30.length).fill(null);
            var nullSmoth_SSMA35_h1 = Array(closedPrice_h1.length - SSMA35Arr_h1.length).fill(null);
            var nullSmoth_SSMA35_h4 = Array(closedPrice_h4.length - SSMA35Arr_h4.length).fill(null);

            var nullSmoth_SSMA100_m1 = Array(closedPrice_m1.length - SSMA100Arr_m1.length).fill(null);
            var nullSmoth_SSMA100_m5 = Array(closedPrice_m5.length - SSMA100Arr_m5.length).fill(null);
            var nullSmoth_SSMA100_m15 = Array(closedPrice_m15.length - SSMA100Arr_m15.length).fill(null);
            var nullSmoth_SSMA100_m30 = Array(closedPrice_m30.length - SSMA100Arr_m30.length).fill(null);
            var nullSmoth_SSMA100_h1 = Array(closedPrice_h1.length - SSMA100Arr_h1.length).fill(null);
            var nullSmoth_SSMA100_h4 = Array(closedPrice_h4.length - SSMA100Arr_h4.length).fill(null);


            dataMA6_m1 =  nullSmoth_SSMA6_m1.concat(SSMA6Arr_m1); 
            dataMA6_m5 =  nullSmoth_SSMA6_m5.concat(SSMA6Arr_m5); 
            dataMA6_m15 =  nullSmoth_SSMA6_m15.concat(SSMA6Arr_m15); 
            dataMA6_m30 =  nullSmoth_SSMA6_m30.concat(SSMA6Arr_m30); 
            dataMA6_h1 =  nullSmoth_SSMA6_h1.concat(SSMA6Arr_h1); 
            dataMA6_h4 =  nullSmoth_SSMA6_h4.concat(SSMA6Arr_h4); 

            dataMA10_m1 =  nullSmoth_SSMA10_m1.concat(SSMA10Arr_m1); 
            dataMA10_m5 =  nullSmoth_SSMA10_m5.concat(SSMA10Arr_m5);
            dataMA10_m15 =  nullSmoth_SSMA10_m15.concat(SSMA10Arr_m15);
            dataMA10_m30 =  nullSmoth_SSMA10_m30.concat(SSMA10Arr_m30);
            dataMA10_h1 =  nullSmoth_SSMA10_h1.concat(SSMA10Arr_h1);
            dataMA10_h4 =  nullSmoth_SSMA10_h4.concat(SSMA10Arr_h4);
            
            dataMA20_m1 =  nullSmoth_SSMA20_m1.concat(SSMA20Arr_m1); 
            dataMA20_m5 =  nullSmoth_SSMA20_m5.concat(SSMA20Arr_m5); 
            dataMA20_m15 =  nullSmoth_SSMA20_m15.concat(SSMA20Arr_m15); 
            dataMA20_m30 =  nullSmoth_SSMA20_m30.concat(SSMA20Arr_m30); 
            dataMA20_h1 =  nullSmoth_SSMA20_h1.concat(SSMA20Arr_h1); 
            dataMA20_h4 =  nullSmoth_SSMA20_h1.concat(SSMA20Arr_h4); 

            dataMA35_m1 =  nullSmoth_SSMA35_m1.concat(SSMA35Arr_m1); 
            dataMA35_m5 =  nullSmoth_SSMA35_m5.concat(SSMA35Arr_m5); 
            dataMA35_m15 =  nullSmoth_SSMA35_m15.concat(SSMA35Arr_m15); 
            dataMA35_m30 =  nullSmoth_SSMA35_m30.concat(SSMA35Arr_m30); 
            dataMA35_h1 =  nullSmoth_SSMA35_h1.concat(SSMA35Arr_h1); 
            dataMA35_h4 =  nullSmoth_SSMA35_h4.concat(SSMA35Arr_h4); 

            dataMA100_m1 =  nullSmoth_SSMA100_m1.concat(SSMA100Arr_m1); 
            dataMA100_m5 =  nullSmoth_SSMA100_m5.concat(SSMA100Arr_m5); 
            dataMA100_m15 =  nullSmoth_SSMA100_m15.concat(SSMA100Arr_m15); 
            dataMA100_m30 =  nullSmoth_SSMA100_m30.concat(SSMA100Arr_m30); 
            dataMA100_h1 =  nullSmoth_SSMA100_h1.concat(SSMA100Arr_h1); 
            dataMA100_h4 =  nullSmoth_SSMA100_h4.concat(SSMA100Arr_h4); 

            dataBody_m1 = GetBodySize(data_m1);
            dataBody_m5 = GetBodySize(data_m5);
            dataBody_m15 = GetBodySize(data_m15);
            dataBody_m30 = GetBodySize(data_m30);
            dataBody_h1 = GetBodySize(data_h1);
            dataBody_h4 = GetBodySize(data_h4);
            
            let regressiveEq_m1 = genRegressionLine(dataMA100_m1,lineLenght)
            let regressiveEq_m5 = genRegressionLine(dataMA100_m5,lineLenght)
            let regressiveEq_m15 = genRegressionLine(dataMA100_m15,lineLenght)
            let regressiveEq_m30 = genRegressionLine(dataMA100_m30,lineLenght)
            let regressiveEq_h1 = genRegressionLine(dataMA100_h1,lineLenght)
            let regressiveEq_h4 = genRegressionLine(dataMA100_h4,lineLenght)

            $('#m1_slope').html(regressiveEq_m1[0].toFixed(8))
            $('#m5_slope').html(regressiveEq_m5[0].toFixed(8))
            $('#m15_slope').html(regressiveEq_m15[0].toFixed(8))
            $('#m30_slope').html(regressiveEq_m30[0].toFixed(8))
            $('#h1_slope').html(regressiveEq_h1[0].toFixed(8))
            $('#h4_slope').html(regressiveEq_h4[0].toFixed(8))

            // if(regressiveEq_m1[0] > 0 && regressiveEq_m5[0] > 0 && regressiveEq_m15[0] > 0 && regressiveEq_m30[0] > 0 && regressiveEq_h1[0] > 0){
            if(regressiveEq_m1[0] > 0 && regressiveEq_m5[0] > 0 && regressiveEq_m15[0] > 0 ){
                alltimeframetrend = [1,0]
            // }else if(regressiveEq_m1[0] < 0 && regressiveEq_m5[0] < 0 && regressiveEq_m15[0] < 0 && regressiveEq_m30[0] < 0 && regressiveEq_h1[0] < 0){
            }else if(regressiveEq_m1[0] < 0 && regressiveEq_m5[0] < 0 && regressiveEq_m15[0] < 0 ){
                alltimeframetrend = [0,1]
            }else{
                alltimeframetrend = [0,0]
            }
            // markMA100LineCord = getCoord(regressiveEq,dataMA100_m1.length-1-lineLenght,dataMA100_m1.length-1,lineLenght)

            // sma100Trend = isUpTrend(regressiveEq[0],data_m1,dataMA100_m1,lineLenght,slopeSpec)
            
            // 

            // var ohlc_timeframe_arr = response.ohlctimeframe
           
            // let tfs_from_m1data_arr =  createTfDataSearchFromM1(getOhlcTimeframesDataFromM1(data_m1))

            // var tfs_arr = createTfDataSearch(ohlc_timeframe_arr)
            // console.log(alltimeframetrend)

            // console.log(m1)
            //////////////  CALCULATION SECTION ////////////////////

            
            let std_lot = (calculationinfo.balance/2500).toFixed(2)
            if(std_lot > 50){
                std_lot = 50
            }
            
            let onOrder =false;



            ////////////  IchimokuCheck Check ///////////////////////
            // console.log(data_h1)
            let ichimokuCheckUptrendH1 = IchimokuCheckUptrend(data_h1,tenkan_sen_h1,kijun_sen_h1,chisou_span_h1,senkou_span_a_h1,senkou_span_b_h1)
            let ichimokuCheckDowntrendH1 = IchimokuCheckDowntrend(data_h1,tenkan_sen_h1,kijun_sen_h1,chisou_span_h1,senkou_span_a_h1,senkou_span_b_h1)

            let ichimokuCheckUptrendH4 = IchimokuCheckUptrend(data_h4,tenkan_sen_h4,kijun_sen_h4,chisou_span_h4,senkou_span_a_h4,senkou_span_b_h4)
            let ichimokuCheckDowntrendH4 = IchimokuCheckDowntrend(data_h4,tenkan_sen_h4,kijun_sen_h4,chisou_span_h4,senkou_span_a_h4,senkou_span_b_h4)

            if(ichimokuCheckUptrendH1 == true){
                console.log('ichimoku Uptrend at H1')
            }

            if(ichimokuCheckDowntrendH1 == true){
                console.log('ichimoku Downtrend at H1')
            }

            if(ichimokuCheckUptrendH4 == true){
                console.log('ichimoku Uptrend at H4')
            }

            if(ichimokuCheckDowntrendH4 == true){
                console.log('ichimoku Downtrend at H4')
            }



            









            if((dataMA100_m1[dataMA100_m1.length-1]+1.5*stdbarsize) < dataMA35_m1[dataMA35_m1.length-1] && (dataMA35_m1[dataMA35_m1.length-1]+stdbarsize) < dataMA20_m1[dataMA20_m1.length-1] && (dataMA20_m1[dataMA20_m1.length-1]+0.5*stdbarsize) < dataMA6_m1[dataMA6_m1.length-1] && alltimeframetrend[0] == 1){  
                 if(dataBody_m1[dataBody_m1.length-1] > dataBody_m1[dataBody_m1.length-2] &&  dataBody_m1[dataBody_m1.length-2]  >  dataBody_m1[dataBody_m1.length-3]  &&  dataBody_m1[dataBody_m1.length-4]  >  dataBody_m1[dataBody_m1.length-3]  &&  dataBody_m1[dataBody_m1.length-5]  >  dataBody_m1[dataBody_m1.length-4] && dataBody_m1[dataBody_m1.length-3] > (dataMA6_m1[dataMA6_m1.length-3] + 0.25*stdbarsize) ){
                    beep();
                    console.log('check Pullback:' + calculationinfo.symbol)
                    let inloopData = []
                    let inloopDataGuage = []
                        for (let i = 1; i < 10; i++) {
                            let check = dataBody_m1[dataBody_m1.length-i] - dataMA6_m1[dataMA6_m1.length-i]
                      
                            if(check > 0){
                                break
                            }
                            inloopData.push(dataBody_m1[dataBody_m1.length-i])
                            inloopDataGuage.push(dataMA20_m1[dataMA20_m1.length-i])
                        }
                        let maxInloopData = Math.max(...inloopData);
                        let mininloopDataGuage = Math.min(...inloopDataGuage);
                        let swing = false
                        if(inloopData.length < 5 && maxInloopData > mininloopDataGuage){
                            let crossCount = 0
                            for (let i = 1; i < 30; i++) {
                                if(dataBody_m1[dataBody_m1.length-i] > dataMA6_m1[dataMA6_m1.length-i] && dataBody_m1[dataBody_m1.length-i+1] < dataMA6_m1[dataMA6_m1.length-i+1]){
                                    if(dataMA100_m1[dataMA100_m1.length-i] < dataMA35_m1[dataMA35_m1.length-i] && dataMA35_m1[dataMA35_m1.length-i] < dataMA20_m1[dataMA20_m1.length-i] && dataMA20_m1[dataMA20_m1.length-i] < dataMA6_m1[dataMA6_m1.length-i]
                                    && dataMA100_m1[dataMA100_m1.length-i] < dataMA20_m1[dataMA20_m1.length-i] && dataMA100_m1[dataMA100_m1.length-i] < dataMA6_m1[dataMA6_m1.length-i]){

                                    }else{
                                        swing = true
                                    }
                                    crossCount++
                                }
                            }
                            console.log(crossCount + ' ' + swing)
                            
                            if(crossCount < 2 && swing == false){
                                // alert('Pullback uptrend')
                                console.log('Pullback uptrend')
                                console.log(alltimeframetrend)
                                onOrder = true
                                result=calculationinfo.symbol + ' (Pullback uptrend) ' + data_m1[data_m1.length-1][5] + ' [BUY]'
                                openOrder(calculationinfo.symbol,'buy',std_lot,'M1').then(data => { //0=order on Buy 1=order on Sell                                    
                                    // lineNotification(result).then(data => {
                                    //     beep();
                                    //     location.reload(true);
                                    // }).catch(error => {})
                                }).catch(error => {})
                            }
                            
                        }
                 }
                }
                
                if(dataMA100_m1[dataMA100_m1.length-1] > (dataMA35_m1[dataMA35_m1.length-1]+1.5*stdbarsize) && dataMA35_m1[dataMA35_m1.length-1] > (dataMA20_m1[dataMA20_m1.length-1]+stdbarsize) && dataMA20_m1[dataMA20_m1.length-1] > (dataMA6_m1[dataMA6_m1.length-1]+0.5*stdbarsize) && alltimeframetrend[1] == 1){
                    if(dataBody_m1[dataBody_m1.length-1] > dataBody_m1[dataBody_m1.length-2] &&  dataBody_m1[dataBody_m1.length-2]  >  dataBody_m1[dataBody_m1.length-3]  &&  dataBody_m1[dataBody_m1.length-4]  >  dataBody_m1[dataBody_m1.length-3]  &&  dataBody_m1[dataBody_m1.length-5]  >  dataBody_m1[dataBody_m1.length-4] && (dataBody_m1[dataBody_m1.length-1]+0.5*stdbarsize) < dataMA6_m1[dataMA6_m1.length-1]){
                        beep();
                        console.log('check Pullback:' + calculationinfo.symbol)
                        let inloopData = []
                        let inloopDataGuage = []
                        for (let i = 1; i < 10; i++) {
                            let check = dataBody_m1[dataBody_m1.length-i] - dataMA6_m1[dataMA6_m1.length-i]
                      
                            if(check < 0){
                                break
                            }
                            inloopData.push(dataBody_m1[dataBody_m1.length-i])
                            inloopDataGuage.push(dataMA20_m1[dataMA20_m1.length-i])
                        }
                        let maxInloopData = Math.max(...inloopData);
                        let mininloopDataGuage = Math.min(...inloopDataGuage);
                        let swing = false
                        if(inloopData.length < 5 && maxInloopData < mininloopDataGuage){
                            let crossCount = 0
                            for (let i = 1; i < 30; i++) {
                                if(dataBody_m1[dataBody_m1.length-i] < dataMA6_m1[dataMA6_m1.length-i] && dataBody_m1[dataBody_m1.length-i+1] > dataMA6_m1[dataMA6_m1.length-i+1]){
                                    if(dataMA100_m1[dataMA100_m1.length-i] > dataMA35_m1[dataMA35_m1.length-i] && dataMA35_m1[dataMA35_m1.length-i] > dataMA20_m1[dataMA20_m1.length-i] && dataMA20_m1[dataMA20_m1.length-i] > dataMA6_m1[dataMA6_m1.length-i]
                                    && dataMA100_m1[dataMA100_m1.length-i] > dataMA20_m1[dataMA20_m1.length-i] && dataMA100_m1[dataMA100_m1.length-i] > dataMA6_m1[dataMA6_m1.length-i]){

                                    }else{
                                        swing = true
                                    }
                                    crossCount++
                                }
                            }
                            console.log(crossCount + ' ' + swing)
                            
                            if(crossCount < 2 && swing == false){
                                console.log('Pullback downtrend')
                                console.log(alltimeframetrend)
                                onOrder = true
                                result=calculationinfo.symbol + ' (Pullback downtrend) ' + data_m1[data_m1.length-1][5] + ' [SELL]'
                                openOrder(calculationinfo.symbol,'sell',std_lot,'M1').then(data => { //0=order on Buy 1=order on Sell                                    
                                    // lineNotification(result).then(data => {
                                    //     beep();
                                    //     location.reload(true);
                                    // }).catch(error => {})
                                }).catch(error => {})
                            }
                        }
                    }
                }


                
                if(dataMA100_m1[dataMA100_m1.length-1] > (dataMA35_m1[dataMA35_m1.length-1]+1.5*stdbarsize) && dataMA35_m1[dataMA35_m1.length-1] > (dataMA20_m1[dataMA20_m1.length-1]+stdbarsize) && dataMA20_m1[dataMA20_m1.length-1] > (dataMA6_m1[dataMA6_m1.length-1]+0.5*stdbarsize) && alltimeframetrend[1] == 1){
                    if(dataBody_m1[dataBody_m1.length-1] < dataMA6_m1[dataMA6_m1.length-1] && dataBody_m1[dataBody_m1.length-2] > dataMA6_m1[dataMA6_m1.length-2] ){
                        let inloopData = []
                        let inloopDataGuage = []
                        for (let i = 1; i < 10; i++) {
                            let check = dataBody_m1[dataBody_m1.length-i] - dataMA6_m1[dataMA6_m1.length-i]
                      
                            if(check < 0){
                                break
                            }
                            inloopData.push(dataBody_m1[dataBody_m1.length-i])
                            inloopDataGuage.push(dataMA20_m1[dataMA20_m1.length-i])
                        }
                        let maxInloopData = Math.max(...inloopData);
                        let mininloopDataGuage = Math.min(...inloopDataGuage);
                        let swing = false
                        if(inloopData.length < 5 && maxInloopData < mininloopDataGuage){
                            let crossCount = 0
                            for (let i = 1; i < 30; i++) {
                                if(dataBody_m1[dataBody_m1.length-i] < dataMA6_m1[dataMA6_m1.length-i] && dataBody_m1[dataBody_m1.length-i+1] > dataMA6_m1[dataMA6_m1.length-i+1]){
                                    if(dataMA100_m1[dataMA100_m1.length-i] > dataMA35_m1[dataMA35_m1.length-i] && dataMA35_m1[dataMA35_m1.length-i] > dataMA20_m1[dataMA20_m1.length-i] && dataMA20_m1[dataMA20_m1.length-i] > dataMA6_m1[dataMA6_m1.length-i]
                                    && dataMA100_m1[dataMA100_m1.length-i] > dataMA20_m1[dataMA20_m1.length-i] && dataMA100_m1[dataMA100_m1.length-i] > dataMA6_m1[dataMA6_m1.length-i]){

                                    }else{
                                        swing = true
                                    }
                                    crossCount++
                                }
                            }
                            console.log(crossCount)
                            if(crossCount < 2 && swing == false){
                                console.log('Toggle downtrend')
                                console.log(alltimeframetrend)
                                onOrder = true
                                result=calculationinfo.symbol + ' (Toggle downtrend) ' + data_m1[data_m1.length-1][5] + ' [SELL]'
                                openOrder(calculationinfo.symbol,'sell',std_lot,'M1').then(data => { //0=order on Buy 1=order on Sell                                    
                                    lineNotification(result).then(data => {
                                        beep();
                                        location.reload(true);
                                    }).catch(error => {})
                                }).catch(error => {})
                            }
                        }
                    }
                }

                if((dataMA100_m1[dataMA100_m1.length-1]+1.5*stdbarsize) < dataMA35_m1[dataMA35_m1.length-1] && (dataMA35_m1[dataMA35_m1.length-1]+stdbarsize) < dataMA20_m1[dataMA20_m1.length-1] && (dataMA20_m1[dataMA20_m1.length-1]+0.5*stdbarsize) < dataMA6_m1[dataMA6_m1.length-1] && alltimeframetrend[0] == 1){
                    if(dataBody_m1[dataBody_m1.length-1] > dataMA6_m1[dataMA6_m1.length-1] && dataBody_m1[dataBody_m1.length-2] < dataMA6_m1[dataMA6_m1.length-2] ){
                        let inloopData = []
                        let inloopDataGuage = []
                        for (let i = 1; i < 10; i++) {
                            let check = dataBody_m1[dataBody_m1.length-i] - dataMA6_m1[dataMA6_m1.length-i]
                      
                            if(check > 0){
                                break
                            }
                            inloopData.push(dataBody_m1[dataBody_m1.length-i])
                            inloopDataGuage.push(dataMA20_m1[dataMA20_m1.length-i])
                        }
                        let maxInloopData = Math.max(...inloopData);
                        let mininloopDataGuage = Math.min(...inloopDataGuage);
                        let swing = false
                        if(inloopData.length < 5 && maxInloopData > mininloopDataGuage){
                            let crossCount = 0
                            for (let i = 1; i < 30; i++) {
                                if(dataBody_m1[dataBody_m1.length-i] > dataMA6_m1[dataMA6_m1.length-i] && dataBody_m1[dataBody_m1.length-i+1] < dataMA6_m1[dataMA6_m1.length-i+1]){
                                    if(dataMA100_m1[dataMA100_m1.length-i] < dataMA35_m1[dataMA35_m1.length-i] && dataMA35_m1[dataMA35_m1.length-i] < dataMA20_m1[dataMA20_m1.length-i] && dataMA20_m1[dataMA20_m1.length-i] < dataMA6_m1[dataMA6_m1.length-i]
                                    && dataMA100_m1[dataMA100_m1.length-i] < dataMA20_m1[dataMA20_m1.length-i] && dataMA100_m1[dataMA100_m1.length-i] < dataMA6_m1[dataMA6_m1.length-i]){

                                    }else{
                                        swing = true
                                    }
                                    crossCount++
                                }
                            }
                            console.log(crossCount)
                            if(crossCount < 2 && swing == false){
                                console.log('Toggle uptrend')
                                console.log(alltimeframetrend)
                                onOrder = true
                                result=calculationinfo.symbol + ' (Toggle uptrend) ' + data_m1[data_m1.length-1][5] + ' [BUY]'
                                openOrder(calculationinfo.symbol,'buy',std_lot,'M1').then(data => { //0=order on Buy 1=order on Sell                                    
                                    lineNotification(result).then(data => {
                                        beep();
                                        location.reload(true);
                                    }).catch(error => {})
                                }).catch(error => {})
                            }
                            
                        }
                    }
                }

                if( onOrder == true){
                    $('#tab_header').html(calculationinfo.symbol + '(Found)')
                }else{
                    $('#tab_header').html(calculationinfo.symbol)
                }
                

            let d = new Date(data_m1[data_m1.length-1][5]);

            let minute = d.getUTCMinutes()
            let hour = d.getUTCHours();
            clock_option.animationDurationUpdate = 300;
            clock.setOption({
            series: [
                {
                name: 'hour',
                animation: hour !== 0,
                data: [{ value: hour }]
                },
                {
                name: 'minute',
                animation: minute !== 0,
                data: [{ value: minute }]
                }
            ]
            });

         

            canndle_stick_chart_m1.setOption({
                series : [
                    
                    {
                        name: 'M1 OHLC',
                        data: data_m1,
                    }, 
                    {
                        name: 'BODY OHLC',
                        data: dataBody_m1,
                    }
                    , 
                    {
                        name: 'MA6',
                        data: dataMA6_m1,
                    }
                    , 
                    {
                        name: 'MA20',
                        data: dataMA20_m1,
                    }
                    , 
                    {
                        name: 'MA35',
                        data: dataMA35_m1,
                    }
                    , 
                    {
                        name: 'MA100',
                        data: dataMA100_m1,
                    }
   
                ],                
                xAxis : [
                    {
                        data : axisData_m1
                    }
                ],
                dataZoom : {
                    // start : 90.5,
                    start : 70,
                    end : 100
                },
            });

            canndle_stick_chart_m5.setOption({
                series : [
                    
                    {
                        name: 'M5 OHLC',
                        data: data_m5,
                    } , 
                    {
                        name: 'BODY OHLC',
                        data: dataBody_m5,
                    }
                    , 
                    {
                        name: 'MA6',
                        data: dataMA6_m5,
                    }
                    , 
                    {
                        name: 'MA20',
                        data: dataMA20_m5,
                    }
                    , 
                    {
                        name: 'MA35',
                        data: dataMA35_m5,
                    }
                    ,  
                    {
                        name: 'MA100',
                        data: dataMA100_m5,
                    }
   
                ],                
                xAxis : [
                    {
                        data : axisData_m5
                    }
                ],
                dataZoom : {
                    // start : 90.5,
                    start : 70,
                    end : 100
                },
            });

            canndle_stick_chart_m15.setOption({
                series : [
                    
                    {
                        name: 'M15 OHLC',
                        data: data_m15,
                    }
                    , 
                    {
                        name: 'BODY OHLC',
                        data: dataBody_m15,
                    }
                    , 
                    {
                        name: 'MA6',
                        data: dataMA6_m15,
                    }
                    , 
                    {
                        name: 'MA20',
                        data: dataMA20_m15,
                    }
                    , 
                    {
                        name: 'MA35',
                        data: dataMA35_m15,
                    }
                    , 
                    {
                        name: 'MA100',
                        data: dataMA100_m15,
                    }
   
                ],                
                xAxis : [
                    {
                        data : axisData_m15
                    }
                ],
                dataZoom : {
                    // start : 90.5,
                    start : 70,
                    end : 100
                },
            });

            canndle_stick_chart_m30.setOption({
                series : [
                    
                    {
                        name: 'M30 OHLC',
                        data: data_m30,
                    } , 
                    {
                        name: 'BODY OHLC',
                        data: dataBody_m30,
                    }
                    , 
                    {
                        name: 'MA6',
                        data: dataMA6_m30,
                    }
                    , 
                    {
                        name: 'MA20',
                        data: dataMA20_m30,
                    }
                    , 
                    {
                        name: 'MA35',
                        data: dataMA35_m30,
                    }
                    , 
                    {
                        name: 'MA100',
                        data: dataMA100_m30,
                    } ,                   ,  
                    {
                        name: 'Tenkan',
                        data: tenkan_sen_m30,
                    }
                    ,  
                    {
                        name: 'Kijun',
                        data: kijun_sen_m30,
                    }
                    ,  
                    {
                        name: 'SpanA',
                        data: senkou_span_a_m30,
                    }
                    ,  
                    {
                        name: 'SpanB',
                        data: senkou_span_b_m30,
                    }
                    ,  
                    {
                        name: 'Chisou',
                        data: chisou_span_m30,
                    }
   
                ],                
                xAxis : [
                    {
                        data : axisData_m30
                    }
                ],
                dataZoom : {
                    // start : 90.5,
                    start : 60,
                    end : 100
                },
            }); 

            
            canndle_stick_chart_h1.setOption({
                series : [
                    
                    {
                        name: 'H1 OHLC',
                        data: data_h1,
                    } , 
                    {
                        name: 'BODY OHLC',
                        data: dataBody_h1,
                    }
                    , 
                    {
                        name: 'MA6',
                        data: dataMA6_h1,
                    }
                    , 
                    {
                        name: 'MA20',
                        data: dataMA20_h1,
                    }
                    , 
                    {
                        name: 'MA35',
                        data: dataMA35_h1,
                    }
                    ,  
                    {
                        name: 'MA100',
                        data: dataMA100_h1,
                    } ,                   ,  
                    {
                        name: 'Tenkan',
                        data: tenkan_sen_h1,
                    }
                    ,  
                    {
                        name: 'Kijun',
                        data: kijun_sen_h1,
                    }
                    ,  
                    {
                        name: 'SpanA',
                        data: senkou_span_a_h1,
                    }
                    ,  
                    {
                        name: 'SpanB',
                        data: senkou_span_b_h1,
                    }
                    ,  
                    {
                        name: 'Chisou',
                        data: chisou_span_h1,
                    }
   
                ],                
                xAxis : [
                    {
                        data : axisData_h1
                    }
                ],
                dataZoom : {
                    // start : 90.5,
                    start : 60,
                    end : 100
                },
            }); 

                 
            canndle_stick_chart_h4.setOption({
                series : [
                    
                    {
                        name: 'H4 OHLC',
                        data: data_h4,
                    } , 
                    {
                        name: 'BODY OHLC',
                        data: dataBody_h4,
                    }
                    , 
                    {
                        name: 'MA6',
                        data: dataMA6_h4,
                    }
                    , 
                    {
                        name: 'MA20',
                        data: dataMA20_h4,
                    }
                    , 
                    {
                        name: 'MA35',
                        data: dataMA35_h4,
                    }
                    ,  
                    {
                        name: 'MA100',
                        data: dataMA100_h4,
                    }
                    ,  
                    {
                        name: 'Tenkan',
                        data: tenkan_sen_h4,
                    }
                    ,  
                    {
                        name: 'Kijun',
                        data: kijun_sen_h4,
                    }
                    ,  
                    {
                        name: 'SpanA',
                        data: senkou_span_a_h4,
                    }
                    ,  
                    {
                        name: 'SpanB',
                        data: senkou_span_b_h4,
                    }
                    ,  
                    {
                        name: 'Chisou',
                        data: chisou_span_h4,
                    }
   
                ],                
                xAxis : [
                    {
                        data : axisData_h4
                    }
                ],
                dataZoom : {
                    // start : 90.5,
                    start : 60,
                    end : 100
                },
            }); 
     
            // let ma100slope = regressiveEq[0]
            
            // let currentDate = new Date(data_m1[data_m1.length-1][5]);
            // let currentHour = currentDate.getUTCHours()

        }

        option_canndle_stick_chart_m1 = {
            backgroundColor: '#21202D',
            title : {
                // text: 'OHLC',
                textStyle: {
                    color: '#fff'
                }
            },
            tooltip : {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                },
                showDelay: 0,             // delay ms
                // formatter: function (params) {
                //     var res = params[0].name;
                //     res += '<br/>' + params[0].seriesName;
                //     res += '<br/>  Open : ' + params[0].value[1] + '  High : ' + params[0].value[4];
                //     res += '<br/>  Close : ' + params[0].value[2] + '  Low : ' + params[0].value[3];
                //     return res;
                // }
            },
            legend: {
                data:['M1 OHLC','BODY OHLC','MA6','MA20','MA35','MA100'],
                selected:{'SSMA20':false},
                textStyle: {
                    color: '#fff'
                }
            },
            toolbox: {
                show : true,
                feature : {
                    // mark : {show: true},
                    // dataZoom : {show: true},
                    // magicType : {show: true, type: ['line', 'bar']},
                    // restore : {show: true},
                    saveAsImage : {
                        show: true,
                        title: 'Save As picture'
                    }
                }
            },            
            // dataZoom : 
            //     {
            //         show : true,
            //         realtime: true,
            //         start : Math.round((data_m1.length-90)/(data_m1.length)*100),
            //         end : 100,
            //         handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
            //         handleSize: '80%',
            //         textStyle: {
            //             color: '#fff'
            //         },
            //         handleStyle: {
            //             color: '#fff',
            //             shadowBlur: 3,
            //             shadowColor: 'rgba(0, 0, 0, 0.6)',
            //             shadowOffsetX: 2,
            //             shadowOffsetY: 2
            //         }
            //     },
            grid: {
                left: 80,
                top: 40,
                right: 20,
                bottom: 85
            },
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : true,
                    axisTick: {onGap:false},
                    splitLine: {show:false},
                    data : axisData_m1,
                    axisLine:{
                        lineStyle:{
                            color:'#aca9a9'
                        }
                    },
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    scale:true,
                    boundaryGap: [0.05, 0.05],
                    splitArea : {show : true},
                    
                    axisLine:{
                        lineStyle:{
                            color:'#aca9a9'
                        }
                    },
                }
            ],
            series : [
                {
                    name:'M1 OHLC',
                    type:'candlestick',
                    data: data_m1,
                    // markPoint: {
                    //     label: {
                    //         normal: {
                    //             formatter: function (param) {
                    //                 return param != null ? param.data['name'] : '';
                    //             }
                    //         }
                    //     },
                    //     data: MarkData,
                    // },
                    itemStyle: {
                        color: upColor,
                        color0: downColor,
                        borderColor: null,
                        borderColor0: null
                    },
                }, 
                {
                    name: 'BODY OHLC',
                    type: 'line',
                    data: dataBody_m1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA6',
                    type: 'line',
                    data: dataMA6_m1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA20',
                    type: 'line',
                    data: dataMA20_m1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA35',
                    type: 'line',
                    data: dataMA35_m1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA100',
                    type: 'line',
                    data: dataMA100_m1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }
         
            ]
        };

        option_canndle_stick_chart_m5 = {
            backgroundColor: '#21202D',
            title : {
                // text: 'OHLC',
                textStyle: {
                    color: '#fff'
                }
            },
            tooltip : {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                },
                showDelay: 0,             // delay ms
                // formatter: function (params) {
                //     var res = params[0].name;
                //     res += '<br/>' + params[0].seriesName;
                //     res += '<br/>  Open : ' + params[0].value[1] + '  High : ' + params[0].value[4];
                //     res += '<br/>  Close : ' + params[0].value[2] + '  Low : ' + params[0].value[3];
                //     return res;
                // }
            },
            legend: {
                data:['M5 OHLC','BODY OHLC','MA6','MA20','MA35','MA100'],
                selected:{'SSMA20':false},
                textStyle: {
                    color: '#fff'
                }
            },
            toolbox: {
                show : true,
                feature : {
                    // mark : {show: true},
                    // dataZoom : {show: true},
                    // magicType : {show: true, type: ['line', 'bar']},
                    // restore : {show: true},
                    saveAsImage : {
                        show: true,
                        title: 'Save As picture'
                    }
                }
            },            
            dataZoom : 
                {
                    show : true,
                    realtime: true,
                    start : Math.round((data_m5.length-90)/(data_m5.length)*100),
                    end : 100,
                    handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                    handleSize: '80%',
                    textStyle: {
                        color: '#fff'
                    },
                    handleStyle: {
                        color: '#fff',
                        shadowBlur: 3,
                        shadowColor: 'rgba(0, 0, 0, 0.6)',
                        shadowOffsetX: 2,
                        shadowOffsetY: 2
                    }
                },
            grid: {
                left: 80,
                top: 40,
                right: 20,
                bottom: 85
            },
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : true,
                    axisTick: {onGap:false},
                    splitLine: {show:false},
                    data : axisData_m5,
                    axisLine:{
                        lineStyle:{
                            color:'#aca9a9'
                        }
                    },
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    scale:true,
                    boundaryGap: [0.05, 0.05],
                    splitArea : {show : true},
                    
                    axisLine:{
                        lineStyle:{
                            color:'#aca9a9'
                        }
                    },
                }
            ],
            series : [
                {
                    name:'M5 OHLC',
                    type:'candlestick',
                    data: data_m5,
                    // markPoint: {
                    //     label: {
                    //         normal: {
                    //             formatter: function (param) {
                    //                 return param != null ? param.data['name'] : '';
                    //             }
                    //         }
                    //     },
                    //     data: MarkData,
                    // },
                    itemStyle: {
                        color: upColor,
                        color0: downColor,
                        borderColor: null,
                        borderColor0: null
                    },
                }, 
                {
                    name: 'BODY OHLC',
                    type: 'line',
                    data: dataBody_m5,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA6',
                    type: 'line',
                    data: dataMA6_m5,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA20',
                    type: 'line',
                    data: dataMA20_m5,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA35',
                    type: 'line',
                    data: dataMA35_m5,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                },  
                {
                    name: 'MA100',
                    type: 'line',
                    data: dataMA100_m5,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }
 
         
            ]
        };

        option_canndle_stick_chart_m15 = {
            backgroundColor: '#21202D',
            title : {
                // text: 'OHLC',
                textStyle: {
                    color: '#fff'
                }
            },
            tooltip : {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                },
                showDelay: 0,             // delay ms
                // formatter: function (params) {
                //     var res = params[0].name;
                //     res += '<br/>' + params[0].seriesName;
                //     res += '<br/>  Open : ' + params[0].value[1] + '  High : ' + params[0].value[4];
                //     res += '<br/>  Close : ' + params[0].value[2] + '  Low : ' + params[0].value[3];
                //     return res;
                // }
            },
            legend: {
                data:['M15 OHLC','BODY OHLC','MA6','MA20','MA35','MA100'],
                selected:{'SSMA20':false},
                textStyle: {
                    color: '#fff'
                }
            },
            toolbox: {
                show : true,
                feature : {
                    // mark : {show: true},
                    // dataZoom : {show: true},
                    // magicType : {show: true, type: ['line', 'bar']},
                    // restore : {show: true},
                    saveAsImage : {
                        show: true,
                        title: 'Save As picture'
                    }
                }
            },            
            dataZoom : 
                {
                    show : true,
                    realtime: true,
                    start : Math.round((data_m15.length-90)/(data_m15.length)*100),
                    end : 100,
                    handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                    handleSize: '80%',
                    textStyle: {
                        color: '#fff'
                    },
                    handleStyle: {
                        color: '#fff',
                        shadowBlur: 3,
                        shadowColor: 'rgba(0, 0, 0, 0.6)',
                        shadowOffsetX: 2,
                        shadowOffsetY: 2
                    }
                },
            grid: {
                left: 80,
                top: 40,
                right: 20,
                bottom: 85
            },
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : true,
                    axisTick: {onGap:false},
                    splitLine: {show:false},
                    data : axisData_m15,
                    axisLine:{
                        lineStyle:{
                            color:'#aca9a9'
                        }
                    },
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    scale:true,
                    boundaryGap: [0.05, 0.05],
                    splitArea : {show : true},
                    
                    axisLine:{
                        lineStyle:{
                            color:'#aca9a9'
                        }
                    },
                }
            ],
            series : [
                {
                    name:'M15 OHLC',
                    type:'candlestick',
                    data: data_m15,
                    // markPoint: {
                    //     label: {
                    //         normal: {
                    //             formatter: function (param) {
                    //                 return param != null ? param.data['name'] : '';
                    //             }
                    //         }
                    //     },
                    //     data: MarkData,
                    // },
                    itemStyle: {
                        color: upColor,
                        color0: downColor,
                        borderColor: null,
                        borderColor0: null
                    },
                }, 
                {
                    name: 'BODY OHLC',
                    type: 'line',
                    data: dataBody_m15,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA6',
                    type: 'line',
                    data: dataMA6_m15,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA20',
                    type: 'line',
                    data: dataMA20_m15,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA35',
                    type: 'line',
                    data: dataMA35_m15,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                },  
                {
                    name: 'MA100',
                    type: 'line',
                    data: dataMA100_m15,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } 
 
         
            ]
        };

        option_canndle_stick_chart_m30 = {
            backgroundColor: '#21202D',
            title : {
                // text: 'OHLC',
                textStyle: {
                    color: '#fff'
                }
            },
            tooltip : {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                },
                showDelay: 0,             // delay ms
                // formatter: function (params) {
                //     var res = params[0].name;
                //     res += '<br/>' + params[0].seriesName;
                //     res += '<br/>  Open : ' + params[0].value[1] + '  High : ' + params[0].value[4];
                //     res += '<br/>  Close : ' + params[0].value[2] + '  Low : ' + params[0].value[3];
                //     return res;
                // }
            },
            legend: {
                data:['M30 OHLC','BODY OHLC','MA6','MA20','MA35','MA100','Tenkan','Kijun','SpanA','SpanB','Chisou'],
                selected:{'SSMA20':false},
                textStyle: {
                    color: '#fff'
                }
            },
            toolbox: {
                show : true,
                feature : {
                    // mark : {show: true},
                    // dataZoom : {show: true},
                    // magicType : {show: true, type: ['line', 'bar']},
                    // restore : {show: true},
                    saveAsImage : {
                        show: true,
                        title: 'Save As picture'
                    }
                }
            },            
            dataZoom : 
                {
                    show : true,
                    realtime: true,
                    start : Math.round((data_m30.length-90)/(data_m30.length)*100),
                    end : 100,
                    handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                    handleSize: '80%',
                    textStyle: {
                        color: '#fff'
                    },
                    handleStyle: {
                        color: '#fff',
                        shadowBlur: 3,
                        shadowColor: 'rgba(0, 0, 0, 0.6)',
                        shadowOffsetX: 2,
                        shadowOffsetY: 2
                    }
                },
            grid: {
                left: 80,
                top: 40,
                right: 20,
                bottom: 85
            },
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : true,
                    axisTick: {onGap:false},
                    splitLine: {show:false},
                    data : axisData_m30,
                    axisLine:{
                        lineStyle:{
                            color:'#aca9a9'
                        }
                    },
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    scale:true,
                    boundaryGap: [0.05, 0.05],
                    splitArea : {show : true},
                    
                    axisLine:{
                        lineStyle:{
                            color:'#aca9a9'
                        }
                    },
                }
            ],
            series : [
                {
                    name:'M30 OHLC',
                    type:'candlestick',
                    data: data_m30,
                    // markPoint: {
                    //     label: {
                    //         normal: {
                    //             formatter: function (param) {
                    //                 return param != null ? param.data['name'] : '';
                    //             }
                    //         }
                    //     },
                    //     data: MarkData,
                    // },
                    itemStyle: {
                        color: upColor,
                        color0: downColor,
                        borderColor: null,
                        borderColor0: null
                    },
                }, 
                {
                    name: 'BODY OHLC',
                    type: 'line',
                    data: dataBody_m30,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA6',
                    type: 'line',
                    data: dataMA6_m30,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA20',
                    type: 'line',
                    data: dataMA20_m30,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA35',
                    type: 'line',
                    data: dataMA35_m30,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                },  
                {
                    name: 'MA100',
                    type: 'line',
                    data: dataMA100_m30,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                },  
                {
                    name: 'Tenkan',
                    type: 'line',
                    data: tenkan_sen_m30,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'Kijun',
                    type: 'line',
                    data: kijun_sen_m30,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'SpanA',
                    type: 'line',
                    data: senkou_span_a_m30,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'SpanB',
                    type: 'line',
                    data: senkou_span_b_m30,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'Chisou',
                    type: 'line',
                    data: chisou_span_m30,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }
 
         
            ]
        };

        option_canndle_stick_chart_h1 = {
            backgroundColor: '#21202D',
            title : {
                // text: 'OHLC',
                textStyle: {
                    color: '#fff'
                }
            },
            tooltip : {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                },
                showDelay: 0,             // delay ms
                // formatter: function (params) {
                //     var res = params[0].name;
                //     res += '<br/>' + params[0].seriesName;
                //     res += '<br/>  Open : ' + params[0].value[1] + '  High : ' + params[0].value[4];
                //     res += '<br/>  Close : ' + params[0].value[2] + '  Low : ' + params[0].value[3];
                //     return res;
                // }
            },
            legend: {
                data:['H1 OHLC','BODY OHLC','MA6','MA20','MA35','MA100','Tenkan','Kijun','SpanA','SpanB','Chisou'],
                selected:{'SSMA20':false},
                textStyle: {
                    color: '#fff'
                }
            },
            toolbox: {
                show : true,
                feature : {
                    // mark : {show: true},
                    // dataZoom : {show: true},
                    // magicType : {show: true, type: ['line', 'bar']},
                    // restore : {show: true},
                    saveAsImage : {
                        show: true,
                        title: 'Save As picture'
                    }
                }
            },            
            dataZoom : 
                {
                    show : true,
                    realtime: true,
                    start : Math.round((data_h1.length-90)/(data_h1.length)*100),
                    end : 100,
                    handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                    handleSize: '80%',
                    textStyle: {
                        color: '#fff'
                    },
                    handleStyle: {
                        color: '#fff',
                        shadowBlur: 3,
                        shadowColor: 'rgba(0, 0, 0, 0.6)',
                        shadowOffsetX: 2,
                        shadowOffsetY: 2
                    }
                },
            grid: {
                left: 80,
                top: 40,
                right: 20,
                bottom: 85
            },
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : true,
                    axisTick: {onGap:false},
                    splitLine: {show:false},
                    data : axisData_h1,
                    axisLine:{
                        lineStyle:{
                            color:'#aca9a9'
                        }
                    },
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    scale:true,
                    boundaryGap: [0.05, 0.05],
                    splitArea : {show : true},
                    
                    axisLine:{
                        lineStyle:{
                            color:'#aca9a9'
                        }
                    },
                }
            ],
            series : [
                {
                    name:'M1 OHLC',
                    type:'candlestick',
                    data: data_h1,
                    // markPoint: {
                    //     label: {
                    //         normal: {
                    //             formatter: function (param) {
                    //                 return param != null ? param.data['name'] : '';
                    //             }
                    //         }
                    //     },
                    //     data: MarkData,
                    // },
                    itemStyle: {
                        color: upColor,
                        color0: downColor,
                        borderColor: null,
                        borderColor0: null
                    },
                }, 
                {
                    name: 'BODY OHLC',
                    type: 'line',
                    data: dataBody_h1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA6',
                    type: 'line',
                    data: dataMA6_h1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA20',
                    type: 'line',
                    data: dataMA20_h1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA35',
                    type: 'line',
                    data: dataMA35_h1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                },  
                {
                    name: 'MA100',
                    type: 'line',
                    data: dataMA100_h1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'Tenkan',
                    type: 'line',
                    data: tenkan_sen_h1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'Kijun',
                    type: 'line',
                    data: kijun_sen_h1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'SpanA',
                    type: 'line',
                    data: senkou_span_a_h1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'SpanB',
                    type: 'line',
                    data: senkou_span_b_h1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'Chisou',
                    type: 'line',
                    data: chisou_span_h1,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }
 
         
            ]
        };

        option_canndle_stick_chart_h4 = {
            backgroundColor: '#21202D',
            title : {
                // text: 'OHLC',
                textStyle: {
                    color: '#fff'
                }
            },
            tooltip : {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                },
                showDelay: 0,             // delay ms
                // formatter: function (params) {
                //     var res = params[0].name;
                //     res += '<br/>' + params[0].seriesName;
                //     res += '<br/>  Open : ' + params[0].value[1] + '  High : ' + params[0].value[4];
                //     res += '<br/>  Close : ' + params[0].value[2] + '  Low : ' + params[0].value[3];
                //     return res;
                // }
            },
            legend: {
                data:['H4 OHLC','BODY OHLC','MA6','MA20','MA35','MA100','Tenkan','Kijun','SpanA','SpanB','Chisou'],
                selected:{'SSMA20':false},
                textStyle: {
                    color: '#fff'
                }
            },
            toolbox: {
                show : true,
                feature : {
                    // mark : {show: true},
                    // dataZoom : {show: true},
                    // magicType : {show: true, type: ['line', 'bar']},
                    // restore : {show: true},
                    saveAsImage : {
                        show: true,
                        title: 'Save As picture'
                    }
                }
            },            
            dataZoom : 
                {
                    show : true,
                    realtime: true,
                    start : Math.round((data_h4.length-90)/(data_h4.length)*100),
                    end : 100,
                    handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                    handleSize: '80%',
                    textStyle: {
                        color: '#fff'
                    },
                    handleStyle: {
                        color: '#fff',
                        shadowBlur: 3,
                        shadowColor: 'rgba(0, 0, 0, 0.6)',
                        shadowOffsetX: 2,
                        shadowOffsetY: 2
                    }
                },
            grid: {
                left: 80,
                top: 40,
                right: 20,
                bottom: 85
            },
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : true,
                    axisTick: {onGap:false},
                    splitLine: {show:false},
                    data : axisData_h1,
                    axisLine:{
                        lineStyle:{
                            color:'#aca9a9'
                        }
                    },
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    scale:true,
                    boundaryGap: [0.05, 0.05],
                    splitArea : {show : true},
                    
                    axisLine:{
                        lineStyle:{
                            color:'#aca9a9'
                        }
                    },
                }
            ],
            series : [
                {
                    name:'H4 OHLC',
                    type:'candlestick',
                    data: data_h4,
                    // markPoint: {
                    //     label: {
                    //         normal: {
                    //             formatter: function (param) {
                    //                 return param != null ? param.data['name'] : '';
                    //             }
                    //         }
                    //     },
                    //     data: MarkData,
                    // },
                    itemStyle: {
                        color: upColor,
                        color0: downColor,
                        borderColor: null,
                        borderColor0: null
                    },
                }, 
                {
                    name: 'BODY OHLC',
                    type: 'line',
                    data: dataBody_h4,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA6',
                    type: 'line',
                    data: dataMA6_h4,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA20',
                    type: 'line',
                    data: dataMA20_h4,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }, 
                {
                    name: 'MA35',
                    type: 'line',
                    data: dataMA35_h4,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                },  
                {
                    name: 'MA100',
                    type: 'line',
                    data: dataMA100_h4,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'Tenkan',
                    type: 'line',
                    data: tenkan_sen_h4,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'Kijun',
                    type: 'line',
                    data: kijun_sen_h4,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'SpanA',
                    type: 'line',
                    data: senkou_span_a_h4,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'SpanB',
                    type: 'line',
                    data: senkou_span_b_h4,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                } ,  
                {
                    name: 'Chisou',
                    type: 'line',
                    data: chisou_span_h4,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }
 
         
            ]
        };






        canndle_stick_chart_m1.setOption(option_canndle_stick_chart_m1);
        canndle_stick_chart_m5.setOption(option_canndle_stick_chart_m5);
        canndle_stick_chart_m15.setOption(option_canndle_stick_chart_m15);
        canndle_stick_chart_m30.setOption(option_canndle_stick_chart_m30);
        canndle_stick_chart_h1.setOption(option_canndle_stick_chart_h1);
        canndle_stick_chart_h4.setOption(option_canndle_stick_chart_h4);


        // canndle_stick_tf_m5.setOption(option_canndle_stick_tf_m5);
   ;
        
        // echarts.connect([canndleStickChart,macdChart,canndleStickChartZoom,canndle_stick_tf_m5]);

        if(responseData.length !== 0){
            createData(responseData);
            window.onresize = function () {
                canndle_stick_chart_m1.resize();
                canndle_stick_chart_m5.resize();
                canndle_stick_chart_m15.resize();
                canndle_stick_chart_m30.resize();
                canndle_stick_chart_h1.resize();
                canndle_stick_chart_h4.resize();
            }
        }


    $(document).on('click','.openorder',function(){
        $('#btnGetSingleOhlc').removeClass('start').addClass('stop');
        $('#btnGetSingleOhlc').html('Start Search');
        clearInterval(searchTimer);
        console.log($(this).data('symbol'))
        getSymbolInfo($(this).data('symbol')).then(data => { //0=order on Buy 1=order on Sell
            let _calculationinfo = data.calculationInfo;
            let _stdbarsize = JSON.parse(data.barsize)[0].fields

            var ohlc_timeframe_arr = data.ohlctimeframe
           

            let pippriceperlotsize = pipPricePerLotsize(_calculationinfo.symbol,_calculationinfo.degit,_calculationinfo.ask,_calculationinfo.trade_contract_size,1,usdbase)*10;
            let stoplossprice = parseFloat(stopLossPrice(_stdbarsize.stoplostpercent,parseFloat(_calculationinfo.balance)))
            let lotsize = getLotSize(stoplossprice,_stdbarsize.stoplostpip,pippriceperlotsize).toFixed(5)*_stdbarsize.lotsizeoffset

            // let spreadprice = (calculationinfo.spread * pippriceperlotsize/10).toFixed(5)

            bullishall = bullishAllTimeframe(ohlc_timeframe_arr)
            bearishall = bearishAllTimeframe(ohlc_timeframe_arr)

            // console.log('bullishall: ' + bullishall)
            // console.log('bearishall: ' + bearishall)
      
            // console.log(ohlc_timeframe_arr)

            $('#stoplost').val(stoplossprice)
            $('#takeprofit').val(2*stoplossprice)
            $('#lotsize').val(lotsize)
            if(bullishall == true){
                $("#ordertype option[value='0']").attr("selected","selected");
                $('#price').val(_calculationinfo.bid)
            }else if(bearishall == true){
                $("#ordertype option[value='1']").attr("selected","selected");
                $('#price').val(_calculationinfo.ask)
            }
            
            $('#symbolname').val(_calculationinfo.symbol)
        }).catch(error => {})

        $('#openorder_modal').modal('show');

    })

    $(document).on('click','#ordering',function(){
        let order_type = 'sell'
        if (parseInt($('#ordertype option:selected').val()) == 0){
            order_type = 'buy'
        }
        // console.log($('#symbolname').val())
        openOrder($('#symbolname').val(),order_type,parseFloat($('#lotsize').val()),'M1').then(data => { //0=order on Buy 1=order on Sell

            location.reload(true);
            // Swal.fire({
            //     icon: 'info',
            //     title: 'Result',
            //     html: `<h2>${data.result[7]}</h2>` 
            // })
        }).catch(error => {})
    })

    $(document).on('click','#openbuyorder',function(){
        let std_lot = (calculationinfo.balance/2500).toFixed(2)
        if(std_lot > 50){
            std_lot = 50
        }


       if (alltimeframetrend[0] != 1){
        Swal.fire({
                title: 'Not trend',
                text: "Confirm to open order",
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'OK'
                }).then((result) => {
                if (result.isConfirmed) {
                    openOrder(calculationinfo.symbol,'buy',std_lot,'M1').then(data => { //0=order on Buy 1=order on Sell                                    
   
                    }).catch(error => {})
                 
                }
            })
       }else{
            openOrder(calculationinfo.symbol,'buy',std_lot,'M1').then(data => { //0=order on Buy 1=order on Sell                                    
   
            }).catch(error => {})
       }
    })

    $(document).on('click','#opensellorder',function(){
        let std_lot = (calculationinfo.balance/2500).toFixed(2)
        if(std_lot > 50){
            std_lot = 50
        }

        if (alltimeframetrend[1] != 1){
        Swal.fire({
                title: 'Not trend',
                text: "Confirm to open order",
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'OK'
                }).then((result) => {
                if (result.isConfirmed) {
                    openOrder(calculationinfo.symbol,'sell',std_lot,'M1').then(data => { //0=order on Buy 1=order on Sell                                    

                    }).catch(error => {})
                 
                }
            })
       }else{
        openOrder(calculationinfo.symbol,'sell',std_lot,'M1').then(data => { //0=order on Buy 1=order on Sell                                    

        }).catch(error => {})
       }

    })

    function getSymbolInfo(symbol){   
        return new Promise((resolve, reject) => {
            data = {
                symbol: symbol,
                csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
            }
            $.ajax({
                type: 'POST',
                url: "{% url 'getsymbolinfo' %}",
                dataType : "json",
                data: data,
                success: function(data) {
                    resolve(data)
                },
                error: function(error) {
                    reject(error)
                },
            })
        })
    }

    function openOrder(symbol,ordertype,lot,comment){   
        return new Promise((resolve, reject) => {
            data = {
                symbol: symbol,
                ordertype: ordertype,
                lot: lot,
                comment: comment,
                csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
            }
            $.ajax({
                type: 'POST',
                url: "{% url 'openorder' %}",
                dataType : "json",
                data: data,
                success: function(data) {
                    resolve(data)
                },
                error: function(error) {
                    reject(error)
                },
            })
        })
    }

       function lineNotification(message){   
           return new Promise((resolve, reject) => {
                data = {
                    message: message,
                    csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
                }
               $.ajax({
                   type: 'POST',
                   url: "{% url 'lineNotification' %}",
                   dataType : "json",
                   data: data,
                   success: function(data) {
                       resolve(data)
                   },
                   error: function(error) {
                       reject(error)
                   },
               })
           })
       }

       var viewsymbol = '';
       
       $(document).on('click','.viewtimeframe',function(){
        viewsymbol = $(this).data('symbol')

            $('#modal-viewtimeframe').modal('show')
        })


        $('#modal-viewtimeframe').on('shown.bs.modal', function (e) {
            getSingleOhlc(viewsymbol,1).then(data_item => {
                createDataViewer(data_item);
            }).catch(error => {})
        })

        // let timestamp = null
        $(document).on('click','#uploadImage',function(){
            fname = $('#symbol').html() +'-'+data_m1[data_m1.length-1][5].replaceAll(":", "-");
            var img_tf_from_m1 = new Image();
            var img_tf_all = new Image();
            var img_ohlc = new Image();
            var img_ohlc_zoom = new Image();
            img_tf_from_m1.src = canndle_stick_tf_from_m1data.getDataURL({
                pixelRatio: 2,
                backgroundColor: '#fff'
            });

            
            img_tf_all.src = canndle_stick_tf_all.getDataURL({
                pixelRatio: 2,
                backgroundColor: '#fff'
            });

            img_ohlc.src = canndleStickChart.getDataURL({
                pixelRatio: 2,
                backgroundColor: '#fff'
            });


            img_ohlc_zoom.src = canndleStickChartZoom.getDataURL({
                pixelRatio: 2,
                backgroundColor: '#fff'
            });


            uploadImage(fname,img_tf_from_m1.src,img_tf_all.src,img_ohlc.src,img_ohlc_zoom.src).then(data_item => {
                
            }).catch(error => {})
        })

        function uploadImage(fname,base64_tf_from_m1,base64_tf_all,base64_ohlc,base64_ohlc_zoom){   
           return new Promise((resolve, reject) => {
                _data = {
                    fname : fname,
                    base64_tf_from_m1: base64_tf_from_m1,
                    base64_tf_all: base64_tf_all,
                    base64_ohlc: base64_ohlc,
                    base64_ohlc_zoom : base64_ohlc_zoom,
                    csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
                }
               $.ajax({
                   type: 'POST',
                   url: "{% url 'uploadimage' %}",
                   dataType : "json",
                   data: _data,
                   success: function(_data) {
                       resolve(_data)
                   },
                   error: function(error) {
                       reject(error)
                   },
               })
           })
       }
    </script>

{% endblock %} 
